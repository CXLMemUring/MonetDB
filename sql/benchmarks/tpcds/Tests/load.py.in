import sys

try:
    from MonetDBtesting import process
except ImportError:
    import process

def server_stop(s):
    out, err = s.communicate()
    sys.stdout.write(out)
    sys.stderr.write(err)

def client(input):
    c = process.client('sql', stdin = process.PIPE, stdout = process.PIPE, stderr = process.PIPE)
    out, err = c.communicate(input)
    sys.stdout.write(out)
    sys.stderr.write(err)

script1 = '''\
START TRANSACTION;\
COPY       1 RECORDS INTO dbgen_version          FROM '$TSTDATAPATH/tpcds/0.01/dbgen_version.dat'          USING DELIMITERS '|', '|\n' NULL AS '';\
COPY      20 RECORDS INTO income_band            FROM '$TSTDATAPATH/tpcds/0.01/income_band.dat'            USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       1 RECORDS INTO warehouse              FROM '$TSTDATAPATH/tpcds/0.01/warehouse.dat'              USING DELIMITERS '|', '|\n' NULL AS '';\
COPY      20 RECORDS INTO ship_mode              FROM '$TSTDATAPATH/tpcds/0.01/ship_mode.dat'              USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       1 RECORDS INTO reason                 FROM '$TSTDATAPATH/tpcds/0.01/reason.dat'                 USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       2 RECORDS INTO call_center            FROM '$TSTDATAPATH/tpcds/0.01/call_center.dat'            USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       2 RECORDS INTO store                  FROM '$TSTDATAPATH/tpcds/0.01/store.dat'                  USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       2 RECORDS INTO web_page               FROM '$TSTDATAPATH/tpcds/0.01/web_page.dat'               USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       2 RECORDS INTO web_site               FROM '$TSTDATAPATH/tpcds/0.01/web_site.dat'               USING DELIMITERS '|', '|\n' NULL AS '';\
COPY       3 RECORDS INTO promotion              FROM '$TSTDATAPATH/tpcds/0.01/promotion.dat'              USING DELIMITERS '|', '|\n' NULL AS '';\
COPY    7200 RECORDS INTO household_demographics FROM '$TSTDATAPATH/tpcds/0.01/household_demographics.dat' USING DELIMITERS '|', '|\n' NULL AS '';\
COPY   11718 RECORDS INTO catalog_page           FROM '$TSTDATAPATH/tpcds/0.01/catalog_page.dat'           USING DELIMITERS '|', '|\n' NULL AS '';\
COPY    2000 RECORDS INTO item                   FROM '$TSTDATAPATH/tpcds/0.01/item.dat'                   USING DELIMITERS '|', '|\n' NULL AS '';\
COPY   86400 RECORDS INTO time_dim               FROM '$TSTDATAPATH/tpcds/0.01/time_dim.dat'               USING DELIMITERS '|', '|\n' NULL AS '';\
COPY    1000 RECORDS INTO customer_address       FROM '$TSTDATAPATH/tpcds/0.01/customer_address.dat'       USING DELIMITERS '|', '|\n' NULL AS '';\
COPY    1152 RECORDS INTO web_returns            FROM '$TSTDATAPATH/tpcds/0.01/web_returns.dat'            USING DELIMITERS '|', '|\n' NULL AS '';\
COPY   73049 RECORDS INTO date_dim               FROM '$TSTDATAPATH/tpcds/0.01/date_dim.dat'               USING DELIMITERS '|', '|\n' NULL AS '';\
COPY    1000 RECORDS INTO customer               FROM '$TSTDATAPATH/tpcds/0.01/customer.dat'               USING DELIMITERS '|', '|\n' NULL AS '';\
COPY    8923 RECORDS INTO catalog_returns        FROM '$TSTDATAPATH/tpcds/0.01/catalog_returns.dat'        USING DELIMITERS '|', '|\n' NULL AS '';\
COPY   11925 RECORDS INTO store_returns          FROM '$TSTDATAPATH/tpcds/0.01/store_returns.dat'          USING DELIMITERS '|', '|\n' NULL AS '';\
COPY 1920800 RECORDS INTO customer_demographics  FROM '$TSTDATAPATH/tpcds/0.01/customer_demographics.dat'  USING DELIMITERS '|', '|\n' NULL AS '';\
COPY   11876 RECORDS INTO web_sales              FROM '$TSTDATAPATH/tpcds/0.01/web_sales.dat'              USING DELIMITERS '|', '|\n' NULL AS '';\
COPY  261261 RECORDS INTO inventory              FROM '$TSTDATAPATH/tpcds/0.01/inventory.dat'              USING DELIMITERS '|', '|\n' NULL AS '';\
COPY   89807 RECORDS INTO catalog_sales          FROM '$TSTDATAPATH/tpcds/0.01/catalog_sales.dat'          USING DELIMITERS '|', '|\n' NULL AS '';\
COPY  120527 RECORDS INTO store_sales            FROM '$TSTDATAPATH/tpcds/0.01/store_sales.dat'            USING DELIMITERS '|', '|\n' NULL AS '';\
COMMIT;
'''

s = process.server(args = [], stdin = process.PIPE, stdout = process.PIPE, stderr = process.PIPE)
client(script1)
server_stop(s)
